---
format: fleet
layout: blog
i18n: generate-for-all-locales
collection: |
  (let [tag-reducer (fn [agg {:keys [tags] :as post}]
                      (reduce (fn [agg² tag]
                                (let [tag² (clojure.string/lower-case tag)]
                                  (-> agg²
                                      (assoc-in [tag² :id] tag²)
                                      (update-in [tag² :count] (fnil inc 0))
                                      (update-in [tag² :posts] conj post)))) agg tags))]
    (->> (:artifacts ctx)
         (filter #(and (map? %)
                       (string? (:id %))
                       (re-find #"posts/" (:id %))
                       (:tags %)))
         (reduce tag-reducer {})
         vals))
---
<main id="tags">
  <h1 class="headline">#<(-> ctx :id (clojure.string/replace #"[^/]+/" "") clojure.string/capitalize)></h1>
  <div class="content" id="content">

    <(for [post (->> ctx :posts
                         (filter #(clojure.string/starts-with? (:id %) (str (:locale ctx) "/")))
                         (sort-by :date-published) reverse)] ">
    <article class="blog-post" itemscope="" itemtype="https://schema.org/BlogPosting">
      <h3 class="headline" itemprop="headline">
          <a class="nunito" href="<(:canonical-link post)>" itemprop="url"><(:title post)></a>
      </h3>

      <div class="subheader">
          <div class="byline">
            <img class="author-icon" src="/img/author_placeholder.svg" />
            <section
              class="author"
              itemprop="author"
              itemscope=""
              itemtype="https://schema.org/Person">
              <span itemprop="name"><(:author post)></span>
              <span itemprop="email" style="visibility: hidden"><(:author-email post)></span>
            </section>
          </div>
          <div class="tags">
            <img class="tag-icon" src="/img/tag_placeholder.svg" />
            <ul itemprop="keywords" class="keywords">
              <(if-let [category (:category post)] ">
              <li class="category">
                <a href="/<(str (:locale ctx))>/category/<(-> post :canonical-category)>.html">
                  <(-> category clojure.string/lower-case)>
                </a>
              </li>
              <")>
              <(for [tag (-> post :tags (or []))]
                 (let [tag (clojure.string/lower-case tag)] ">
              <li class="tag">
                <a href="/<(str (:locale ctx))>/tags/<(clojure.string/replace tag #"\\ " "-")>.html"
                  >#<(str tag)></a
                >
              </li>
              <"))>
            </ul>
          </div>
          <p class="post-meta">
            <time itemprop="datePublished"><(:date-published post)></time> -
            <span itemprop="wordCount"><(:word-count post)></span> words -
            <span itemprop="timeRequired"><(:ttr post)></span> min read
          </p>
      </div>
    </article>
    <")>
  </div>
</main> 